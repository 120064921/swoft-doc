# 熔断器

熔断器有三种状态，开启、关闭、半开，每种状态都有不同对应的操作，目前内部使用状态模式实现的。

1. 关闭状态，正常逻辑处理，当失败次数达到上限可以切换到开启状态
2. 开启状态，服务降级处理，一定时间延迟后尝试切换到半开状态
3. 半开状态，正常逻辑处理，当业务失败次数达到一定值，切换到开启，当业务成功次数达到一定值，切换到关闭。

## 配置

熔断器目前主要用于 RPC 内部服务通讯的时候，当RPC调用的使用，内部自动实现了熔断器逻辑，不同的内部服务只需配置不同的熔断器，也可以多个服务使用同一个熔断器。

config/beans/base.php 中配置了用户服务调用的熔断器。注意，熔断器注入的 bean 名称必须是 XXXBreaker ,其中 XXX 是服务名称。

```php
return [
    // ...
    
   "userBreaker" => [
        'class'           => \swoft\circuit\CircuitBreaker::class,
        'swithToSuccessCount' => 6, // 请求成功次数上限(状态切换)
        'swithToFailCount' => 6, // 请求失败次数上限(状态切换)
        'delaySwithTimer' => 5000, // 开启状态切换到半开状态的延迟时间，单位毫秒
    ],
    
    // ...

];
```



